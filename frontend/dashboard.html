<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Service Desk</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <a href="dashboard.html" class="navbar-brand">Service Desk</a>
        <ul class="navbar-nav">
            <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
            <li><a href="tickets.html" class="nav-link">Tickets</a></li>
            <li><a href="board.html" class="nav-link">Board</a></li>
            <li><a href="analytics.html" class="nav-link">Analytics</a></li>
            <li><a href="#" class="nav-link" id="user-name">Loading...</a></li>
            <li><a href="#" class="nav-link" id="logout-btn">–í–∏—Ö—ñ–¥</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1 style="margin-bottom: 2rem;">Dashboard</h1>

        <!-- Stats Cards -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            <div class="card">
                <h3 style="color: var(--gray); font-size: 0.875rem; margin-bottom: 0.5rem;">–í—Å—å–æ–≥–æ —Ç—ñ–∫–µ—Ç—ñ–≤</h3>
                <p style="font-size: 2rem; font-weight: 700;">0</p>
            </div>
            <div class="card">
                <h3 style="color: var(--gray); font-size: 0.875rem; margin-bottom: 0.5rem;">–í —Ç—Ä—ñ–∞–∂—ñ</h3>
                <p style="font-size: 2rem; font-weight: 700; color: var(--warning);">0</p>
            </div>
            <div class="card">
                <h3 style="color: var(--gray); font-size: 0.875rem; margin-bottom: 0.5rem;">–í —Ä–æ–±–æ—Ç—ñ</h3>
                <p style="font-size: 2rem; font-weight: 700; color: var(--primary);">0</p>
            </div>
            <div class="card">
                <h3 style="color: var(--gray); font-size: 0.875rem; margin-bottom: 0.5rem;">–ó–∞–∫—Ä–∏—Ç–æ</h3>
                <p style="font-size: 2rem; font-weight: 700; color: var(--secondary);">0</p>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h2 style="margin-bottom: 1rem;">–®–≤–∏–¥–∫—ñ –¥—ñ—ó</h2>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <a href="tickets.html" class="btn btn-primary">
                    üìã –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ç—ñ–∫–µ—Ç–∏
                </a>
                <a href="board.html" class="btn" style="background: var(--primary); color: white;">
                    üìä Kanban Board
                </a>
                <a href="analytics.html" class="btn" style="background: var(--success); color: white;">
                    üìà Analytics
                </a>
                <a href="create-ticket.html" class="btn btn-secondary">
                    ‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—ñ–∫–µ—Ç
                </a>
                <a href="http://127.0.0.1:8003/docs" target="_blank" class="btn" style="background: var(--dark-lighter); color: var(--text);">
                    üìö API Docs
                </a>
            </div>
        </div>

        <!-- User Info -->
        <div class="card mt-2">
            <h2 style="margin-bottom: 1rem;">–í–∞—à –ø—Ä–æ—Ñ—ñ–ª—å</h2>
            <div id="user-info">
                <div class="loading"></div> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth-guard.js"></script>
    <script>
        async function loadUserInfo() {
            try {
                const user = await api.getMe();
                localStorage.setItem('user', JSON.stringify(user));

                document.getElementById('user-name').textContent = user.email;
                document.getElementById('user-info').innerHTML = `
                    <div style="display: grid; gap: 0.5rem;">
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>–†–æ–ª—å:</strong> <span class="badge badge-status">${user.role}</span></p>
                        <p><strong>–Ü–º'—è:</strong> ${user.full_name || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</p>
                        <p><strong>–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç ID:</strong> ${user.department_id || '–ù–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ'}</p>
                        <p><strong>–ê–∫—Ç–∏–≤–Ω–∏–π:</strong> ${user.is_active ? '‚úÖ –¢–∞–∫' : '‚ùå –ù—ñ'}</p>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load user:', error);
                document.getElementById('user-info').innerHTML = `
                    <div class="alert alert-error">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é</div>
                `;
            }
        }

        document.getElementById('logout-btn').addEventListener('click', (e) => {
            e.preventDefault();
            api.logout();
            window.location.href = 'login.html';
        });

        loadUserInfo();
    </script>
</body>
</html>
